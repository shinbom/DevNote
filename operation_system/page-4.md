# 가상 메모리(Virtual Memory)

컴퓨터가 실제로 이용 가능한 메모리 자원을 추상화 하여 이를 사용하는 사용자들에게 매우 큰 메모리로 보이게 만드는 것

메모리와 가상 메모리는 프로그램이나 데이터를 `페이지(page)`나 `세그먼트(segment)`라는 전송단위로 분할하여 서로 교환한다.

프로세스가 전체 주소 공간을 한꺼번에 사용하지 않으므로, 모든 프로세스에 대해 주소 공간만큼이나 메모리를 할당하기 어렵기도 하며, 매우 비효율적이다.

그래서 메모리는 가상기억장치의 페이지나 세그먼트 복사본의 일부를 가진다.


<br/>

가상적으로 주어진 주소를 `가상 주소(Logical Memory)`라고 하며, 실제 메모리상에 있는 주소를 `실제 주소(Physical Memory)`라고 한다.

가상주소는 `메모리관리장치(MMU)`에 의해 실제 주소로 변환된다.

가상메모리는 가상 주소와 실제 주소가 매핑되어 있고 프로세스의 주소 정보가 들어있는 `페이지 테이블`에 의해 관리된다.

> 속도향상을 위해 TLB를 사용함.

### TLB

메모리와 CPU 사이에 있는 주소 변환을 위한 캐시
페이지 테이블에 있는 리스트를 보관하여 CPU가 페이지 테이블까지 가지 않도록 하여 속도를 향상시킨다.

### 페이지 폴트(Page Fault) 와 스와핑(Swapping)

프로세스의 주소 공간에는 존재하지만 RAM에는 없는 데이터에 접근했을 때 발생한다.

페이지 폴트를 방지하기 위해 `스와핑`이 동작하는데, 바로 사용하지 않는 영역을 하드디스크로 옮기고 필요할때 RAM으로 불러오며, 사용하지 않으면 다시 하드디스크로 내림을 반복한다.

---

## 스레싱(thrashing)

메모리 폴트율이 높은 것을 의미하여, 컴퓨터의 심각한 성능저하를 초래한다.

### 스레싱의 악순환

1. 페이지 폴트가 일어나면 CPU 이용률이 낮아짐
2. 운영체제는 CPU가 가용성을 더 높이고자 더 많은 프로세스를 메모리에 올림

이와같은, 악순환이 박복되며 스레싱이 발생됨.

### 스레싱의 해결방법

1. 메모리를 늘린다.
2. HDD 사용시 SDD로 바꾼다.

운영체제에서 해결할 수 있는 방법은 다음과 같다.

1. 작업세트(working set)
<br/><br/>
프로세스의 과거 사용 이력인 지역성(locality)을 통해 결정된 페이지 집합을 만들어서 미리 메모리에 로드한다.

2. PFF(Page Fault Frequency)
<br/><br/>
페이지 폴트 빈도를 조절하는 방법.<br/>
상한선과 하한선을 만드는 방법이다.<br/>
상한선에 도달한다면 페이지를 늘리고 하한선에 도달한다면 페이지를 줄인다.

